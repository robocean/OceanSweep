# 🛰️ DGPS Module

> DGPS 기반 위치 오차 보정 및 릴레이 서버를 통한 통신 구조 구현

*(본 README.md 파일은 DGPS 모듈의 세부 사항을 포함하며, 전체 프로젝트 개요는 [여기](../README.md)에서 확인할 수 있다.)*

---

## 📌 모듈 개요

`DGPS Module`은 로봇 시스템의 **정밀 위치 정보 획득**을 위해 개발되었다. 해당 모듈은 GPS 신호의 고유한 특성으로 발생하는 위치 오차를 보정하여 로봇의 정확한 위치 정보를 제공하는 것을 목표로 한다. DGPS(Differential Global Positioning System) 방식을 적용하여 정확한 위치를 아는 기준국으로부터 생성된 보정 정보를 활용한다. 통신 거리 제약을 극복하기 위해 공인 IP를 보유한 릴레이 서버를 중계 지점으로 활용하는 통신 구조를 구현하였다.

## ✨ 주요 기능

* **GPS 신호 특성 및 오차 발생 원인 설명**: GPS 신호가 전리층 및 대기권 통과 시 발생하는 지연으로 인해 위치 오차가 발생함을 설명한다.
* **DGPS 시스템 구조 구현**: 정확한 위치를 아는 기준국에서 GPS 신호를 수신하고, 오차 정보를 생성하여 로봇에 전달하는 DGPS 방식을 적용한다. 기준국 위치는 전자 지도(카카오지도)를 기반으로 설정된다.
* **릴레이 서버를 통한 통신 거리 한계 극복**: 로봇과 기준국이 서로 다른 사설망에 위치하여 직접적인 TCP/IP 통신이 불가능한 문제를 해결하기 위해, 공인 IP를 보유한 릴레이 서버를 중계 지점으로 설정하여 간접적인 통신을 가능하게 한다. 기준국은 보정 정보를 릴레이 서버에 전송하고, 로봇은 이를 수신하여 위치를 보정한다.

## ⚙️ 기술 스택 및 구현 환경

* **플랫폼**: Ubuntu PC (릴레이 서버), Window PC (기준국), Raspberry Pi (로봇 측 수신부)
* **통신**: TCP/IP (릴레이 서버 경유)
* **알고리즘**: DGPS 보정 알고리즘

## 🛠️ 작동 원리 및 구현 상세

`DGPS Module`은 로봇의 자율주행에 필수적인 정밀 위치 정보를 확보하기 위해 다음과 같은 원리로 작동한다.

### GPS 신호 특성 및 위치 오차 발생 원인

GPS에는 여러 오차가 존재한다. GPS 위성은 매우 정확한 원자시계를 탑재하고 있으나, 수신기는 값비싼 원자시계를 탑재할 수 없어 대부분 수정 발진기를 이용한 시계를 탑재한다. 이로 인해 시간 오차가 발생하게 된다. 또한 위성으로부터의 전파는 전리층과 대기권을 통과하여 GPS 수신기의 안테나에 도달하게 된다. 전파의 속도는 진공에서 빛의 속도이지만, 지구 표면으로 오면서 전리층과 대기권을 통과하는데 전리층과 대기권의 두께가 일정치 않고 대기 중의 습도에도 영향을 받아 전파의 속도 오차가 발생한다. 이는 수신기 측에서 자체적으로 해결할 수 없다.

### DGPS 개요 및 시스템 구조

이러한 오차를 제거하기 위해, 정확한 위치가 측정된 기준국에서 사용자에게 오차 정보를 전송하여 사용자 위치 정확도를 향상시키는 DGPS(Differential Global Positioning System)가 고안되었다. DGPS를 위해서는 두 개의 GPS 수신기가 필요하다. 하나는 정지해 있고, 다른 하나는 이동하면서 위치를 측정한다. 정지된 수신기는 실제 위성을 이용한 측정값과 이미 정밀하게 결정된 실제값과의 차이를 계산한다. GPS 수신기는 4개 이상의 위성으로부터 신호를 수신하여 위치를 측정하는데, 위성으로부터 수신기까지 이르는 동안 거치는 여러 오차 요인으로 인하여 정확도가 떨어지게 되며, 각 위성의 신호가 이런 식으로 오차를 포함하고 있다. 만약 자신의 정확한 위치를 알고 있는 수신기로 하여금 위성으로부터 계산한 값과 비교하여 오차를 생성하고, 이것을 이동국에 전달하면 신호 경로에 수반되는 오차를 제거할 수 있다.

![dgps](https://drive.google.com/uc?export=view&id=1nJSFtTAOQvJ9CIrH8MgYuJY2E7g3bepO)  
<sub>* DGPS 통신 구조*</sub>

DGPS 시스템은 다음과 같은 방식으로 동작한다:
1.  **기준국 (Reference Station)**: 정확한 위치를 알고 있는 기준국에서 GPS 신호를 수신한다. 기준국 위치는 전자 지도(카카오지도)를 기반으로 설정된다.
2.  **오차 정보 생성**: 기준국은 수신된 GPS 신호와 자신의 정확한 위치를 비교하여 오차 정보를 생성한다.
3.  **이동국 (로봇)**: 로봇은 기준국으로부터 전송된 이 오차 정보를 수신하여 자신의 현재 위치를 보정한다.

### 릴레이 서버를 통한 통신 구현

로봇과 기준국이 서로 다른 사설망에 위치하여 직접적인 TCP/IP 통신이 불가능한 경우가 발생한다. 이러한 통신 제약을 극복하기 위해 **공인 IP를 보유한 릴레이 서버**를 통신 중계 지점으로 설정하였다. DGPS 통신 구조는 이 릴레이 서버를 통해 간접적인 통신이 가능하도록 구현된다. 기준국은 생성된 보정 정보를 릴레이 서버에 전송하며, 로봇은 릴레이 서버로부터 해당 정보를 수신하여 자신의 위치를 보정한다.

릴레이 서버는 클라이언트들(기준국/로봇)들에 대한 소켓연결을 유지하며 한쪽 클라이언트가 전송한 정보를 다른 클라이언트들에게 브로드캐스트 방식으로 전달한다.

이는 추후 연구과제를 통해 군집제어등에 활용되는것을 고려하였기 때문이다.