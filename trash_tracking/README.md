# 🗑️ Trash Tracking Module

> YOLOv5 기반 실시간 해양 쓰레기 탐지 및 비전 제어 시스템

*(본 README.md 파일은 Trash Tracking 모듈의 세부 사항을 포함하며, 전체 프로젝트 개요는 [여기](../README.md)에서 확인할 수 있다.)*

---

## 📌 모듈 개요

`Trash Tracking Module`은 'OceanSweep' 로봇 시스템에서 **수상 환경의 해양 쓰레기를 지능적으로 탐지하고 수거하는 역할**을 담당한다. 본 모듈은 YOLOv5n(You Only Look Once v5 nano) 인공지능 모델을 활용하여 카메라 영상으로부터 부유하는 쓰레기를 실시간으로 탐지한다. 탐지된 객체의 위치 정보를 기반으로 비전 기반 P제어기(Proportional Controller)를 적용하여 로봇이 쓰레기 지점으로 정밀하게 이동 및 정렬한 후 수거를 수행한다. 이는 광활한 해역에서 쓰레기 수거의 효율성 및 정확성을 획기적으로 향상시킨다.

## ✨ 주요 기능

* **실시간 쓰레기 탐지**: 저전력 Jetson Nano 보드에 배포된 YOLOv5n 모델을 활용하여 실시간으로 카메라 영상 내의 해양 쓰레기를 탐지한다.
* **영상처리 기반 P제어기**: 탐지된 쓰레기 객체의 바운딩 박스(Bounding Box) 중심 X 좌표와 영상 프레임 중앙 X 좌표 간의 차이를 계산하여 로봇의 회전 속도를 제어함으로써 쓰레기에 정확하게 정렬 및 접근한다.
* **데이터셋 활용**: Roboflow Universe에서 제공하는 "Detectar Basuras" 데이터셋을 기반으로 인공지능 모델을 학습하였다.
* **성능 평가**: 학습된 인공지능 모델의 성능을 정량적으로 평가하고, 그 결과를 제시한다.

## ⚙️ 기술 스택 및 구현 환경

* **플랫폼**: Jetson Nano (저전력 임베디드 보드)
* **인공지능 프레임워크**: YOLOv5n (PyTorch 1.10 + TensorRT 8.x 최적화)
* **프로그래밍 언어**: Python
* **데이터셋**: Detectar Basuras Dataset (Roboflow Universe)
* **제어 알고리즘**: 비전 기반 P제어 (Proportional Controller)

## 🛠️ 작동 원리 및 구현 상세

`Trash Tracking Module`은 로봇 중앙부 상단에 탑재된 카메라 모듈로부터 실시간 영상 스트림을 수신하는 것으로 작동을 시작한다.

### 인공지능 기반 쓰레기 탐지

수신된 영상은 YOLOv5 인공지능 모델의 입력으로 사용된다. YOLOv5는 RoboFlow의 "Detectar Basuras" (https://universe.roboflow.com/monitoreo-de-playas/detectar-basuras)데이터셋을 기반으로 사전 학습되었으며, Jetson Nano 보드에 배포되어 실시간으로 영상 내 쓰레기 객체를 탐지한다. 탐지 결과는 각 객체의 바운딩 박스 형태로 제공된다.

본 모듈에서 사용된 YOLOv5 모델의 성능 평가는 다음과 같다:

| Class       | Instances | Precision | Recall | MAP50 | MAP50-95 |
| :---------- | :-------- | :-------- | :----- | :---- | :------- |
| all         | 139       | 0.451     | 0.524  | 0.455 | 0.271    |
| plastic     | 11        | 0.359     | 0.455  | 0.37  | 0.245    |
| bottle      | 37        | 0.213     | 0.459  | 0.273 | 0.121    |
| aluminum    | 25        | 0.751     | 0.604  | 0.567 | 0.343    |
| can         | 20        | 0.499     | 0.6    | 0.615 | 0.41     |
| tire        | 21        | 0.561     | 0.549  | 0.569 | 0.306    |
| fishing net | 25        | 0.323     | 0.48   | 0.336 | 0.204    |
| plastic waste | 25      | 0.323     | 0.48   | 0.336 | 0.204    |


### 모델 경량화

인공지능 모델은 젯슨나노상에서 구동된다. 젯슨나노에서 GPU가속을 이용하여 추론속도를 개선하기 위하여 tensorRT모델로 변환하였다. 이를 통해 CPU만 이용하여 추론하는것보다 더 빠른 추론속도를 확보할 수 있었다.

### 영상처리 기반 P제어기 설계

탐지된 쓰레기 객체에 대한 수거를 위해 비전 기반 P제어기가 설계되었다. 이 제어기는 탐지된 객체의 바운딩 박스 중심 X 좌표를 추출하고, 이를 영상 프레임의 중앙 X 좌표($\Delta x$)와의 차이를 계산한다. 로봇의 회전 속도($W_{ref}$)는 이 $\Delta x$에 비례하는 제어식에 따라 계산된다.

![image process](https://drive.google.com/uc?export=view&id=10aIDrrdsEXBaf_NohAyAMynYT2A4Duwe)  
<sub>*영상처리기반 P제어기 설계 알고리즘*</sub>

$w_{ref} = -k \cdot \Delta x$

이렇게 계산된 회전속도는 차동구동기구학을 통해 로봇의 각 바퀴의 구동으로 구현된다.
차동기구학은 waypoint 섹션에서 설명한다.

($k$: 비례 게인)

$\Delta x$가 0에 수렴하도록 로봇이 회전하면서 전진함으로써, 쓰레기를 선체 중앙부로 정확하게 정렬하여 수집할 수 있게 한다. 이러한 제어 로직을 통해 로봇은 수조 환경에서 쓰레기 탐지 및 수거 기능을 성공적으로 검증하였다.
